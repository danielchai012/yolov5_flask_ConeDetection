<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Home</title>
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
    crossorigin="anonymous"></script>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link href="./static/loading.css">
    <script src="https://kit.fontawesome.com/3a45ec8e5b.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="container-fluid text-center">
    <div class="row text-center">
      <div class="col-4"></div>
      <div class="col-4">
        <h1>Yolo V5測試</h1>
        <form class="was-validated" action="/recon" method="post" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="formFile" class="form-label">Image Input</label>
            <div class="row mb-3">
              <div class="col">
                <input class="form-control" name="recon_file" type="file" id="formFile" onchange="readURL(this)" required>
                <div class="invalid-feedback">輸入圖片</div>
                  <h6 id="result">{{result}}</h6>
                  <i class="fal fa-solid fa-spinner fa-fw fa-xl margin-right-md fa-spin" id="loadingicon"style="color: var(--white) ; --fa-animation-duration:2s;display:none " ></i>
                </div>
              </div>
              <div class="col">
                <button type="submit" class="btn btn-primary mt-2" id="submitbutton" onclick='submited(this)'>Submit</button>
                <button type="button" class="btn btn-primary mt-2" id="webcambutton" onclick='webcam(this)'>Webcam</button>
                <button type="button" class="btn btn-primary mt-2" id="streambutton" value='false' onclick='stream(this)'>Stream</button>
              </div>
              <!-- <a class="btn btn-primary mt-2" href="/webcam" onclick='webcam(this)' id="webcambutton" role="button">Webcam</a> -->
            </div>
          </form>
        </div>
        <div class="col-4">
        </div>
    </div>
    <div class="row ">
      <div class="col-6">
        Input
        <img src="{{image}}" id="input" class="img-fluid" height="200px">
        <img src="" id="videostream">
        <!-- <div class="ratio ratio-16x9">
            <iframe src="{{image}}" id="inputvideo" title="YouTube video" allowfullscreen></iframe>
          </div> -->
          <!-- <div class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item" src="./static/1.mp4" allowfullscreen></iframe>
          </div> -->
      </div>
      <div class="col-6">
        Output
        <!-- <a href="{{output_img}}" class="text-primary">預覽</a> -->
        <img src="{{output_img}}" id="output" class="img-fluid" height="600px">
        <!-- <video height="400px" controls>
          <source src='./static/1.mp4' type="video/mp4"> 
        </video> -->
      </div>
    </div>
  </div>
  </div>
  <script>
    
    function submited(button) {
      // button = document.querySelector("#submit");
      button.form.submit();
      document.querySelector("#webcambutton").setAttribute("disabled", true);
      document.querySelector("#streambutton").setAttribute("disabled", true);
      button.disabled = true;
      button.innerText = 'Sending…';
      document.getElementById("loadingicon").style.display = "block";
      document.getElementById("result").innerText = "Loading...";
      document.querySelector("#formFile").setAttribute("disabled", true);
    }
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          document.querySelector("#input").setAttribute("src", e.target.result);
          // document.querySelector("#inputvideo").setAttribute("src",e.target.result);
        };
        reader.readAsDataURL(input.files[0]);
      }
      document.getElementById("result").innerText = "";
    }
    function webcam(button) {
      window.location.href='/webcam'
      button.disabled = true;
      button.innerText = 'Opening…';
      document.getElementById("webcambutton").innerText = "Loading...";
      document.getElementById("loadingicon").style.display = "block";
      document.querySelector("#formFile").setAttribute("disabled", true);
      document.querySelector("#streambutton").setAttribute("disabled", true);
      document.querySelector("#submitbutton").setAttribute("disabled", true);
    }
    function stream(button) {
      if (button.value== 'false'){
        console.log(button.value)
        button.value = true;
        document.getElementById("webcambutton").innerText
        document.getElementById("streambutton").innerText = "Close";
        document.querySelector("#formFile").setAttribute("disabled", true);
        document.querySelector("#submitbutton").setAttribute("disabled", true);
        document.querySelector("#webcambutton").setAttribute("disabled", true);
        document.getElementById("loadingicon").style.display = "block";
        document.getElementById("input").setAttribute("src", '/video_feed');
        document.getElementById("output").setAttribute("src", '');
      } 
      else{
        console.log('closed')
        button.value = false;
        document.getElementById("streambutton").innerText = "Open";
        document.querySelector("#formFile").removeAttribute("disabled");
        document.querySelector("#submitbutton").removeAttribute("disabled");
        document.querySelector("#webcambutton").removeAttribute("disabled");
        document.getElementById("videostream").setAttribute("src", '');
        document.getElementById("loadingicon").style.display = "none";
        document.getElementById("input").setAttribute("src", "{{image}}");
        document.getElementById("output").setAttribute("src", "{{output_img}}");

      }
    }
    </script>
</body>

</html>